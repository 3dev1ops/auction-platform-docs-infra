# 거래 및 경매 정책 (Transaction & Auction Policy)

본 문서는 경매 진행부터 정산 완료까지의 단계별 상태 변화와 정책(Policy)을 정의합니다.

---

## 1. 거래 프로세스 요약 (Lifecycle)

| 단계 | 상태 코드 | 설명 | 발생 가능한 예외 및 이탈 경로 (Exception Flow) |
|:---:|:---:|:---|:---|
| **Step 1** | `PENDING` | 판매자가 물품을 등록하고 경매 시작 대기 중 | • **판매 취소**: 시작 전 판매자가 물품 삭제 |
| **Step 2** | `ACTIVE` | 경매 시작, 입찰 진행 중 (Bidding On) | • **패찰(Outbid)**: 상위 입찰 발생 시 내 홀딩금 즉시 해제<br>• **유찰(Unsold)**: 종료 시점까지 입찰자가 0명인 경우 |
| **Step 3** | `CLOSED` | 경매 종료 및 낙찰자 선정 | • **강제 취소**: 판매자가 일방적으로 판매 거부 (페널티 부여)<br>• **결제 실패**: 시스템 오류 등으로 홀딩금 전환 실패 시 |
| **Step 4** | `SHIPPING` | 판매자 발송 대기 (운송장 입력 필요) | • **미발송 취소**: 기한 내 송장 미입력 시 자동 취소 및 환불 |
| **Step 5** | `DELIVERED` | 구매자 물품 수령 및 확인 | • **반품/분쟁**: 하자로 인해 '구매 확정' 거부 시 분쟁 단계 진입 |
| **Step 6** | `CONFIRMED` | 구매 확정 및 정산 (Transfer) | • (거래 종료 후에는 원칙적으로 시스템 내 취소 불가) |

---

## 2. 상세 시나리오 정의

### 기본 거래 흐름 (Happy Path)

1.  **물품 등록 (Pending)**
    *   판매자가 경매 시작가, 종료 시간, 즉시 구매가 등 조건을 설정하여 등록합니다.
2.  **경매 시작 (Active)**
    *   지정된 시간이 되면 경매가 시작되어 입찰이 가능해집니다.
3.  **입찰 및 홀딩 (Bidding & Holding Policy)**
    *   **자금 검증**: 입찰 시도 시 `보유 잔액 >= 입찰 금액` 여부를 확인합니다.
    *   **선점형 홀딩(Lock)**: 입찰 성공 시 해당 금액만큼 **'사용 불가(Locked)'** 상태로 격리합니다. 계좌에서 실제 차감은 되지 않으나, 타 물품 구매나 출금이 불가능합니다.
        > *예시: 보유액 5만 원 중 3만 원 입찰 시 → 가용 잔액 2만 원.*
4.  **낙찰 확정 (Auction Closed)**
    *   경매 종료 시점의 최고 입찰자가 낙찰자로 선정됩니다.
    *   이미 홀딩된 낙찰 금액은 **'결제 대기'** 상태에서 **'결제 완료(에스크로 보관)'** 상태로 시스템상 확정됩니다.
5.  **배송 (Shipping)**
    *   판매자는 정해진 기한 내에 물품을 발송하고 운송장을 입력해야 합니다.
6.  **구매 확정 및 정산 (Confirmation & Settlement)**
    *   물품 수령 후 구매자가 `[구매 확정]` 버튼을 누르면 홀딩되어 있던 대금이 수수료를 제외하고 판매자 계정으로 **이체(Transfer)** 됩니다.
    *   일정 기간(예: 배송 완료 후 3일) 동안 의사표시가 없으면 **자동 구매 확정** 처리됩니다.

---

## 3. 예외 상황 처리 및 정책 (Edge Cases)

### 패찰 및 홀딩 해제 (Outbid & Unlock)
*   **상황**: 내 입찰가(30,000원)보다 더 높은 금액(35,000원)으로 타인이 입찰한 경우.
*   **처리**: 최고가 경신(Outbid) 즉시 나의 30,000원 홀딩(Lock)은 **자동 해제**되어 다시 가용 잔액으로 복구됩니다.
*   **알림**: "상위 입찰자가 발생하여 보증금 홀딩이 해제되었습니다." 알림 발송.

### 유찰 (Unsold)
*   **상황**: 경매 종료 시까지 입찰자가 0명인 경우.
*   **처리**: 경매는 `UNSOLD` 상태로 종료됩니다. 판매자는 재등록(Re-list)하거나 판매를 취소할 수 있습니다.

### 거래 중단 및 캔슬 (Cancellation)
*   **판매자 귀책 취소**: 낙찰 후 판매자가 물건 파손/분실 등으로 판매를 취소할 경우.
    *   구매자의 홀딩 금액은 즉시 100% 환불(Unlock)됩니다.
    *   판매자에게는 경고 누적 또는 일정 기간 판매 제한 페널티가 부여될 수 있습니다.
*   **미발송 자동 취소**: 낙찰 후 정해진 기한(예: 5일) 내에 운송장이 등록되지 않으면 거래가 자동 취소되고 구매자에게 환불됩니다.

### 반품 및 분쟁 (Return & Dispute)
*   **상황**: 물품 수령 후 파손, 위조품, 설명 불일치 등의 사유 발생.
*   **처리**: 구매자는 구매 확정 대신 `[반품/신고]`를 접수합니다.
*   **분쟁 조정**: 정산은 보류(Hold)되며, 관리자의 검토 또는 당사자 간 합의 후 환불/반품 여부를 결정합니다.

---

## 4. 추가 고려 기능 (Advanced)

*   **마감 임박 연장 (Soft Close)**: 경매 종료 1분 전 입찰 발생 시, 마감 시간을 5분 자동 연장하여 스나이핑 방지.
*   **차순위 협상**: 낙찰자가 구매를 포기할 경우, 2순위 입찰자에게 구매 기회를 제공하는 옵션.
